<template>
    <lightning-card title="Donor Contribution Statement" icon-name="standard:document">
        <div class="slds-p-around_medium">
            
            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <lightning-spinner alternative-text="Generating PDF..."></lightning-spinner>
            </template>

            <!-- Error Message -->
            <template if:true={error}>
                <div class="slds-m-bottom_medium">
                    <lightning-badge label="Error" icon-name="utility:error"></lightning-badge>
                    <p class="slds-text-color_error slds-m-top_x-small">{error}</p>
                </div>
            </template>

            <!-- Transaction Summary -->
            <template if:true={hasTransactions}>
                <div class="slds-m-bottom_medium">
                    <dl class="slds-dl_horizontal">
                        <dt class="slds-dl_horizontal__label">
                            <p class="slds-truncate">Total Transactions:</p>
                        </dt>
                        <dd class="slds-dl_horizontal__detail">
                            <p>{transactions.length}</p>
                        </dd>
                        
                        <dt class="slds-dl_horizontal__label">
                            <p class="slds-truncate">Total Amount:</p>
                        </dt>
                        <dd class="slds-dl_horizontal__detail">
                            <p>${totalAmount}</p>
                        </dd>
                    </dl>
                </div>
            </template>

            <!-- Generate PDF Button -->
            <lightning-button 
                variant="brand" 
                label="Download PDF Statement"
                icon-name="utility:download"
                onclick={handleDownloadPdf}
                disabled={isLoading}>
            </lightning-button>

            <!-- No Data Message -->
            <template if:false={hasTransactions}>
                <template if:false={error}>
                    <div class="slds-m-top_medium">
                        <p class="slds-text-color_weak">No transactions found for this donor.</p>
                    </div>
                </template>
            </template>

            <!-- Transaction Preview Table -->
            <template if:true={hasTransactions}>
                <div class="slds-m-top_large">
                    <h3 class="slds-text-heading_small slds-m-bottom_small">Transaction Preview</h3>
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                        <thead>
                            <tr class="slds-line-height_reset">
                                <th scope="col"><div class="slds-truncate">Date</div></th>
                                <th scope="col"><div class="slds-truncate">Category</div></th>
                                <th scope="col"><div class="slds-truncate">Amount</div></th>
                            </tr>
                        </thead>
                        <tbody>
                            <template for:each={formattedTransactions} for:item="txn">
                                <tr key={txn.Id} class="slds-hint-parent">
                                    <td data-label="Date">
                                        {txn.formattedDate}
                                    </td>
                                    <td data-label="Category">
                                        {txn.category}
                                    </td>
                                    <td data-label="Amount">
                                        ${txn.formattedAmount}
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </template>

        </div>
    </lightning-card>
</template>